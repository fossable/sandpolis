[package]
authors = ["Tyler Cook"]
description = "Ultimate remote monitoring and management"
edition = "2021"
license = "AGPL-3.0-only"
name = "sandpolis"
repository = "https://github.com/fossable/sandpolis"
rust-version = "1.74"
version = "0.0.1"

[build-dependencies]
built = { version = "0.7", features = [
  "cargo-lock",
  "dependency-tree",
  "git2",
  "chrono",
  "semver",
] }

[dev-dependencies]
tempfile = "3.15.0"

[dependencies]
anyhow = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
tokio = { workspace = true }
clap = { workspace = true }
futures = { workspace = true }
rustls = { workspace = true }
tracing = { workspace = true }
axum = { workspace = true }
axum-macros = { workspace = true }
axum-server = { workspace = true }
sandpolis-macros = { path = "../sandpolis-macros" }
sandpolis-network = { path = "../sandpolis-network" }
sandpolis-instance = { path = "../sandpolis-instance" }
sandpolis-group = { path = "../sandpolis-group" }
sandpolis-user = { path = "../sandpolis-user" }
sandpolis-database = { path = "../sandpolis-database" }
sandpolis-server = { path = "../sandpolis-server", optional = true, features = [
  "server",
] }
sandpolis-agent = { path = "../sandpolis-agent", optional = true, features = [
  "agent",
] }
sandpolis-client = { path = "../sandpolis-client", optional = true, features = [
  "client",
] }
sandpolis-power = { path = "../sandpolis-power", optional = true }
sandpolis-sysinfo = { path = "../sandpolis-sysinfo", optional = true }
sandpolis-package = { path = "../sandpolis-package", optional = true }
sandpolis-desktop = { path = "../sandpolis-desktop", optional = true }
sandpolis-filesystem = { path = "../sandpolis-filesystem", optional = true }
sandpolis-shell = { path = "../sandpolis-shell", optional = true }
tracing-subscriber = { version = "0.3.18", features = ["env-filter"] }

# Server dependencies
openraft = { git = "https://github.com/databendlabs/openraft", optional = true, features = [
  "serde",
  "type-alias",
] }

[features]
# Instances
server = ["dep:openraft", "dep:sandpolis-server"]
agent = ["dep:sandpolis-agent"]
client = []

# Layers
layer-account = []
layer-alert = []
layer-deploy = []
layer-desktop = ["dep:sandpolis-desktop"]
layer-filesystem = ["dep:sandpolis-filesystem"]
layer-health = []
layer-inventory = []
layer-location = []
layer-logging = []
layer-package = ["dep:sandpolis-package"]
layer-shell = ["dep:sandpolis-shell"]
layer-snapshot = []
layer-probe = []
layer-power = ["dep:sandpolis-power"]
layer-sysinfo = ["dep:sandpolis-sysinfo"]
layer-tunnel = []

# Enable all layers
default = [
  "layer-desktop",
  "layer-filesystem",
  "layer-shell",
  "layer-sysinfo",
  "layer-inventory",
  "layer-account",
  "layer-logging",
]

# Client features
client-gui = ["client"]
# client-gui-wayland = ["client-gui", "bevy/wayland"]
client-tui = ["client"]
